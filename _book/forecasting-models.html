<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4 Forecasting Models | Gijón Air Pollution - An exercise of visualization and forecasting</title>
  <meta name="description" content="4 Forecasting Models | Gijón Air Pollution - An exercise of visualization and forecasting">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="4 Forecasting Models | Gijón Air Pollution - An exercise of visualization and forecasting" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Forecasting Models | Gijón Air Pollution - An exercise of visualization and forecasting" />
  
  
  

<meta name="author" content="Sergio Berdiales">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="visualizations.html">
<link rel="next" href="conclusions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#why"><i class="fa fa-check"></i><b>1.1</b> Why</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#what"><i class="fa fa-check"></i><b>1.2</b> What</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#how"><i class="fa fa-check"></i><b>1.3</b> How</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-data.html"><a href="the-data.html"><i class="fa fa-check"></i><b>2</b> The Data</a></li>
<li class="chapter" data-level="3" data-path="visualizations.html"><a href="visualizations.html"><i class="fa fa-check"></i><b>3</b> Visualizations</a></li>
<li class="chapter" data-level="4" data-path="forecasting-models.html"><a href="forecasting-models.html"><i class="fa fa-check"></i><b>4</b> Forecasting Models</a><ul>
<li class="chapter" data-level="4.1" data-path="forecasting-models.html"><a href="forecasting-models.html#pm10-forecasts"><i class="fa fa-check"></i><b>4.1</b> PM10 forecasts</a><ul>
<li class="chapter" data-level="" data-path="forecasting-models.html"><a href="forecasting-models.html#arima-results"><i class="fa fa-check"></i>ARIMA results</a></li>
<li class="chapter" data-level="" data-path="forecasting-models.html"><a href="forecasting-models.html#machine-learning-results"><i class="fa fa-check"></i>Machine Learning results</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="forecasting-models.html"><a href="forecasting-models.html#no2-forecasts"><i class="fa fa-check"></i><b>4.2</b> NO2 forecasts</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>5</b> Conclusions</a></li>
<li><a href="r-scripts.html#r-scripts"><em>R scripts</em></a></li>
<li class="chapter" data-level="6" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html"><i class="fa fa-check"></i><b>6</b> Gathering and Cleaning Data</a><ul>
<li class="chapter" data-level="6.1" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#data-gathering"><i class="fa fa-check"></i><b>6.1</b> Data gathering</a></li>
<li class="chapter" data-level="6.2" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#data-cleaning"><i class="fa fa-check"></i><b>6.2</b> Data cleaning</a></li>
<li class="chapter" data-level="6.3" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#adding-new-variables"><i class="fa fa-check"></i><b>6.3</b> Adding new variables</a><ul>
<li class="chapter" data-level="6.3.1" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#time-variables"><i class="fa fa-check"></i><b>6.3.1</b> Time variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#laboral-dates"><i class="fa fa-check"></i><b>6.3.2</b> Laboral dates</a></li>
<li class="chapter" data-level="6.3.3" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#wind-direction"><i class="fa fa-check"></i><b>6.3.3</b> Wind direction</a></li>
<li class="chapter" data-level="6.3.4" data-path="gathering-and-cleaning-data.html"><a href="gathering-and-cleaning-data.html#tables-preparation-for-tableau-dashboards"><i class="fa fa-check"></i><b>6.3.4</b> Tables preparation for Tableau dashboards</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>7</b> Data Exploration</a><ul>
<li class="chapter" data-level="7.1" data-path="data-exploration.html"><a href="data-exploration.html#pm10-constitucion-station"><i class="fa fa-check"></i><b>7.1</b> PM10 Constitucion Station</a></li>
<li class="chapter" data-level="7.2" data-path="data-exploration.html"><a href="data-exploration.html#relationships-between-variables"><i class="fa fa-check"></i><b>7.2</b> Relationships between variables</a></li>
<li class="chapter" data-level="7.3" data-path="data-exploration.html"><a href="data-exploration.html#no2-constitucion-station"><i class="fa fa-check"></i><b>7.3</b> NO2 Constitucion Station</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html"><i class="fa fa-check"></i><b>8</b> Forecasting models. ARIMA</a><ul>
<li class="chapter" data-level="8.0.1" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#data-loading"><i class="fa fa-check"></i><b>8.0.1</b> Data loading</a></li>
<li class="chapter" data-level="8.0.2" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10-forecasting-models"><i class="fa fa-check"></i><b>8.0.2</b> PM10 forecasting models</a></li>
<li class="chapter" data-level="8.0.3" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#train-test-and-validation-data-pm10-models"><i class="fa fa-check"></i><b>8.0.3</b> Train, test and validation data (PM10 models)</a></li>
<li class="chapter" data-level="8.0.4" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#data-exploration-1"><i class="fa fa-check"></i><b>8.0.4</b> Data Exploration</a></li>
<li class="chapter" data-level="8.1" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#base-model."><i class="fa fa-check"></i><b>8.1</b> Base model.</a></li>
<li class="chapter" data-level="8.2" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10-arima-models"><i class="fa fa-check"></i><b>8.2</b> PM10 ARIMA models</a><ul>
<li class="chapter" data-level="8.2.1" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10_model_arima_3m"><i class="fa fa-check"></i><b>8.2.1</b> PM10_model_arima_3m</a></li>
<li class="chapter" data-level="8.2.2" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10_model_arima_3y"><i class="fa fa-check"></i><b>8.2.2</b> PM10_model_arima_3y</a></li>
<li class="chapter" data-level="8.2.3" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10_model_arima_9y"><i class="fa fa-check"></i><b>8.2.3</b> PM10_model_arima_9y</a></li>
<li class="chapter" data-level="8.2.4" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10-h-6"><i class="fa fa-check"></i><b>8.2.4</b> PM10 h = 6</a></li>
<li class="chapter" data-level="8.2.5" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10-h-12"><i class="fa fa-check"></i><b>8.2.5</b> PM10 h = 12</a></li>
<li class="chapter" data-level="8.2.6" data-path="forecasting-models-arima.html"><a href="forecasting-models-arima.html#pm10-h-24"><i class="fa fa-check"></i><b>8.2.6</b> PM10 h = 24</a></li>
</ul></li>
</ul></li>
<li><a href="python-scripts.html#python-scripts"><em>Python scripts</em></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Gijón Air Pollution - An exercise of visualization and forecasting</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="forecasting-models" class="section level1">
<h1><span class="header-section-number">4</span> Forecasting Models</h1>
<p><strong>“Prediction is very difficult, especially if it’s about the future.”</strong> Nils Bohr, Nobel laureate in Physics</p>
<p>As I already explained in the Introduction, one of the objectives of this project is to develop forecasting models which allow us to predict the pollution levels in the city of Gijón some hours in advance.</p>
<p>Initially, I planned to create forecasting models for every monitoring station. But, as soon as I started work on the models I realized this goal was not very realistic. Therefore, I adjusted the scope of my project to just one station, the Constitución station and to only two pollutants, PM10 and NO2.</p>
<p>I chose the Constitución station because it is the only station with published weather data and we focused on these two pollutants because they are the pollutants with the biggest impact on public health.</p>
<p><strong>Methodology.</strong></p>
<p>We make a first approach to the problem with the ARIMA methodology. Then, with the reference of these results we try to improve the forecasts with machine learning methods.</p>
<p>I used R for the ARIMA models and to prepare the training and testing datasets for the Python models.</p>
<p>And I used Python, on the Google Colab platform, to create the machine learning methods.</p>
<p>All the R and Python scripts are saved in the <a href="https://github.com/sergioberdiales/TFM_KSchool_Gijon_Air_Pollution">github repository project</a>:</p>
<ul>
<li>_10_1_train_test_PM10_AR_datasets.rmd</li>
<li>_10_2_train_test_PM10_NO2_MULTIVAR_datasets.rmd</li>
<li>12_Forecasting_Models_ARIMA_PM10.rmd</li>
<li>21_Forecasting_Models_ML_PM10_AR.ipynb</li>
<li>22_Forecasting_Models_ML_PM10_MULTIVAR.ipynb</li>
<li>23_Forecasting_Models_ML_NO2_MULTIVAR.ipynb</li>
</ul>
<p>The R scripts are included in this document too, in the <em>R scripts</em> section. The Python notebooks are not included in this document but the links to the original Google Colab notebooks are in the <em>Python scripts</em> section.</p>
<div id="pm10-forecasts" class="section level2">
<h2><span class="header-section-number">4.1</span> PM10 forecasts</h2>
<div id="arima-results" class="section level3 unnumbered">
<h3>ARIMA results</h3>
<p><strong>“I have seen the future and it is very much like the present, only longer.”</strong> Kehlog Albran, The Profit</p>
<div id="r-markdown-file-12_forecasting_models_arima_pm10.rmd" class="section level4 unnumbered">
<h4>R-markdown file “12_Forecasting_Models_ARIMA_PM10.rmd”</h4>
<p><em>The code used for this section is in the rmarkdown file</em> “12_Forecasting_Models_ARIMA_PM10.rmd” <em>You can consult it in the section 8 “Forecasting models. ARIMA” of this document.</em></p>
<p>As a first step I created a very simple model to use as a base reference. This model takes the value from the previous hour as a prediction, forecasting just one hour ahead. Thus, the formula for this base model would be: Xt = Xt-1.</p>
<p>Then, I generated three different seasonal (frequency: 24 hours) ARIMA models with three different training periods (the ARIMA model parameters were selected automatically by the auto.arima function from the ‘forecast’ R package).</p>
<p>And I applied these three models to the testing period data (2017-01-01 - 2017-09-30) in order to obtain their prediction accuracy scores for the one hour ahead forecast.</p>
<p>Finally, I obtained the prediction accuracy scores for the ARIMA with the three years training period for the 6 hours, 12 hours and 24 hours ahead forecasts.</p>
<p>In the table below we can see the R-squared and the MAE obtained for each ARIMA model tested for the PM10 pollutant.</p>
<table>
<caption><span id="tab:unnamed-chunk-2">Table 4.1: </span>ARIMA models results for the PM10 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared</th>
<th align="right">MAE</th>
<th align="left">Model detail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Auto regressive (Base model)</td>
<td align="left">1 hour</td>
<td align="left">-</td>
<td align="right">0.5327</td>
<td align="right">5.15</td>
<td align="left">PM10t = PM10(t-1)</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">1 hour</td>
<td align="left">201610-201612</td>
<td align="right">0.5975</td>
<td align="right">4.88</td>
<td align="left">ARIMA(2,1,4)(0,0,2)[24]</td>
</tr>
<tr class="odd">
<td align="left">ARIMA</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.6015</td>
<td align="right">4.84</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">1 hour</td>
<td align="left">200901_201612</td>
<td align="right">0.5966</td>
<td align="right">4.88</td>
<td align="left">ARIMA(3,1,2)(0,0,2)[24]</td>
</tr>
<tr class="odd">
<td align="left">ARIMA</td>
<td align="left">6 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.2118</td>
<td align="right">7.12</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">12 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.1108</td>
<td align="right">7.64</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
<tr class="odd">
<td align="left">ARIMA</td>
<td align="left">24 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.0138</td>
<td align="right">10.90</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
</tbody>
</table>
<p><em>All the MAE and R-Squared showed in all the tables and the graphs are from applying the model to the testing period 2017-01-01 - 2017-09-30.</em></p>
<p>We are going to use the MAE (Mean Absolute Error) in order to compare the different models. We chose the MAE over the RMSE (Root Mean Square Error) because it is easier to interpret while also being more robust (less sensitive to outliers).</p>
<p>The base model (Xt = Xt-1) explains 53.3% of the variability of the data from the test period (R-squared: 0.5327) and it has a MAE (Mean Absolute Error) of 5.15.</p>
<p>And the ARIMA model with the best results is the one with the 3 years training period, which improves the Base model R-squaredin by almost 7 points , explaining 60.15% of the variation in the levels of PM10 (one hour ahead) and reduces the MAE to 4.84.</p>
<p>Either way, the differences between the three years training model and the other two are minimal. Three months of training data explains almost the same than three or nine years.</p>
<p>We can see this very clearly in the graph below, where we plot the monthly MAE of each model over the testing period.</p>
<div class="figure">
<img src="imgs/monthly_mae_base_model_vs_arima3m_3y_9y_graph.png" alt="MAE monthly evolution (Testing data. Period 2017-01-01 - 2017-09-30)." />
<p class="caption">MAE monthly evolution (Testing data. Period 2017-01-01 - 2017-09-30).</p>
</div>
<p><strong>Forecasting 6, 12 and 24 hours ahead</strong></p>
<p>The forecasting accuracy of any model decays as we try to forecast further in the future. Therefore, we used the ARIMA model to forecast PM10 values 6, 12 and 24 hours ahead, and we measured its forecasting precision. We can see the results in the table below.</p>
<table>
<caption><span id="tab:unnamed-chunk-3">Table 4.2: </span>ARIMA models results for the PM10 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared</th>
<th align="right">MAE</th>
<th align="left">Model detail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ARIMA</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.6015</td>
<td align="right">4.84</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">6 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.2118</td>
<td align="right">7.12</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
<tr class="odd">
<td align="left">ARIMA</td>
<td align="left">12 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.1108</td>
<td align="right">7.64</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">24 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.0138</td>
<td align="right">10.90</td>
<td align="left">ARIMA(2,1,3)(0,0,2)[24]</td>
</tr>
</tbody>
</table>
<p>We plot the data on a graph in order to observe the differences more easily.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="\textwidth" /></p>
<p>As we see in the graph the explanatory power of the model decays very quickly as we try to forecast further into the future. In fact, the 24 hours prediction hardly explains anything about the variation of the PM10 levels (although we could probably improve the 24 hours forecasting results by modifying the seasonal elements of the ARIMA model ‘P, D, Q’).</p>
</div>
</div>
<div id="machine-learning-results" class="section level3 unnumbered">
<h3>Machine Learning results</h3>
<div class="figure">
<img src="https://imgs.xkcd.com/comics/machine_learning.png" width="250" />

</div>
<p><a href="https://xkcd.com/1838/">xkcd comic</a></p>
<p><em>The code used for this section is in following Jupyter notebook files</em>:</p>
<pre><code>&quot;21_Forecasting_Models_ML_PM10_AR.ipynb&quot;  </code></pre>
<p><a href="https://colab.research.google.com/gist/sergioberdiales/4ba779b51fa0a83499f563b6bdc0bc25/21_forecasting_models_ml_pm10_ar.ipynb">Google Colab Notebook link “21_Forecasting_Models_ML_PM10_AR.ipynb”</a><br />
“22_Forecasting_Models_ML_PM10_MULTIVAR.ipynb”<br />
<a href="https://colab.research.google.com/gist/sergioberdiales/ae75a47dc97c9e64bf43336901dacb17/22_forecasting_models_ml_pm10_multivar.ipynb">Google Colab Notebook link “21_Forecasting_Models_ML_PM10_AR.ipynb”</a><br />
“23_Forecasting_Models_ML_NO2_MULTIVAR”<br />
<a href="https://colab.research.google.com/gist/sergioberdiales/183b0c2421948c455fe047626bed7e9d/23_forecasting_models_ml_no2_multivar.ipynb">Google Colab Notebook link “21_Forecasting_Models_ML_PM10_AR.ipynb”</a></p>
<p><em>The training, testing and validations dataset were prepared previously with R:</em></p>
<p>Rmarkdown file “10_1_train_test_AR_datasets.rmd”<br />
Rmarkdown file “10_2_train_test_PM10_NO2_MULTIVAR_datasets</p>
<div id="auto-regressive-models" class="section level4 unnumbered">
<h4>Auto-regressive models</h4>
<p>In this part we try to emulate the ARIMA results with different auto-regressive machine learning models. So, we are only including lagged values of the target variable as input variables. In this case lagged values of the PM10 pollutant.</p>
<p>We used Linear Regression, Random Forests and XGBoost algorithms, achieving the best results with the XGBoost models.</p>
<p>(We selected the lagged variables through a Linear Regression model, that is why it appears in the table 4 rows of results, 3 with the 33 initial variables and one with the final 13 variables selected.)</p>
<table>
<caption><span id="tab:unnamed-chunk-5">Table 4.3: </span>ARIMA models results for the PM10 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="right">Number of variables</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared adjusted</th>
<th align="right">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Linear regression</td>
<td align="right">33</td>
<td align="left">1 hour</td>
<td align="left">201610-201612</td>
<td align="right">0.5794</td>
<td align="right">4.94</td>
</tr>
<tr class="even">
<td align="left">Linear regression</td>
<td align="right">33</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5944</td>
<td align="right">4.82</td>
</tr>
<tr class="odd">
<td align="left">Linear regression</td>
<td align="right">33</td>
<td align="left">1 hour</td>
<td align="left">200901-201612</td>
<td align="right">0.5880</td>
<td align="right">4.87</td>
</tr>
<tr class="even">
<td align="left">Linear regression</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5932</td>
<td align="right">4.84</td>
</tr>
<tr class="odd">
<td align="left">Random Forest Regressor</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201610-201612</td>
<td align="right">0.5724</td>
<td align="right">4.93</td>
</tr>
<tr class="even">
<td align="left">Random Forest Regressor</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5873</td>
<td align="right">4.90</td>
</tr>
<tr class="odd">
<td align="left">Random Forest Regressor</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">200901-201612</td>
<td align="right">0.5741</td>
<td align="right">5.00</td>
</tr>
<tr class="even">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201610-201612</td>
<td align="right">0.5779</td>
<td align="right">4.92</td>
</tr>
<tr class="odd">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5970</td>
<td align="right">4.81</td>
</tr>
<tr class="even">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">200901-201612</td>
<td align="right">0.5905</td>
<td align="right">4.86</td>
</tr>
<tr class="odd">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">6 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.2400</td>
<td align="right">6.93</td>
</tr>
<tr class="even">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">12 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.1474</td>
<td align="right">7.46</td>
</tr>
<tr class="odd">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">24 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.0514</td>
<td align="right">7.98</td>
</tr>
</tbody>
</table>
<p>And as with the ARIMA models we got the smallest MAE using the three years period for the training dataset (2014-01-01 - 2016-12-31).</p>
<table>
<caption><span id="tab:unnamed-chunk-6">Table 4.4: </span>Machine learning models results for the PM10 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="right">Number of variables</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared adjusted</th>
<th align="right">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Linear regression</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5932</td>
<td align="right">4.84</td>
</tr>
<tr class="even">
<td align="left">Random Forest Regressor</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5873</td>
<td align="right">4.90</td>
</tr>
<tr class="odd">
<td align="left">XGBoost</td>
<td align="right">13</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.5970</td>
<td align="right">4.81</td>
</tr>
</tbody>
</table>
<p>Nevertheless, the results are very similar to the ARIMA ones for the one hour forecasts.</p>
<p>But as we increase the forecast horizon the XGBoost obtains better results than the ARIMA model. <img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="\textwidth" /></p>
</div>
<div id="multi-variate-models" class="section level4 unnumbered">
<h4>Multi-variate models</h4>
<p>And finally, we added other variables to try to improve our forecasting model. In this part we used the XGBoost algorithm exclusively, because so far it is the algorithm which showed the best performance. And for the same reason we will use the three years training period (2014-01-01).</p>
<p>We used two different kinds of variables:</p>
<ol style="list-style-type: decimal">
<li><p>More lagged values of numerical variables, such as weather measurements or other pollutants levels.</p></li>
<li><p>Categorical variables related to information about the target that we can anticipate, such as the hour of the day or the type of day (working days versus non-working days).</p></li>
</ol>
<p>We can see the results in the table below.</p>
<table>
<caption><span id="tab:unnamed-chunk-9">Table 4.5: </span>ARIMA models results for the PM10 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared adjusted</th>
<th align="right">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">XGBoost MV</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.6135</td>
<td align="right">4.71</td>
</tr>
<tr class="even">
<td align="left">XGBoost MV</td>
<td align="left">6 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.2614</td>
<td align="right">6.76</td>
</tr>
<tr class="odd">
<td align="left">XGBoost MV</td>
<td align="left">12 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.1556</td>
<td align="right">7.38</td>
</tr>
<tr class="even">
<td align="left">XGBoost MV</td>
<td align="left">24 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.0807</td>
<td align="right">7.83</td>
</tr>
</tbody>
</table>
<p>We compare the results of all the models graphically. The XGBoost multivariate models slightly increase the results of the XGBoost auto regressive ones, particularly at the prediction horizon of 24 hours. But in the end, the explanatory power and the errors of the models are very similar.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="\textwidth" /></p>
<p>Maybe the contribution from the added variables in the multivariate models are so limited because a big part of this information is already included in the lagged values of the PM10 variable.</p>
<p>In order to improve the model, apart from a better feature engineering of the current variables or the inclusion of new lagged variables (for example: lagged values from other monitoring stations) we think the inclusion of weather forecasts would have a great effect on these pollution predictions. We would, thus, be including future conditions that would help to better anticipate PM10 levels (the wind and the rain have a great influence in the accumulation of air pollutants).</p>
</div>
</div>
</div>
<div id="no2-forecasts" class="section level2">
<h2><span class="header-section-number">4.2</span> NO2 forecasts</h2>
<p>For the NO2 forecasts we skip the ARIMA, Linear Regression and Random Forest models to use the XGBoost algorithm directly, which is the one with better results so far. These are the auto regressive XGBoost models results (Testing data scores. Period: 2017-01-01 - 2017-09-30):</p>
<table>
<caption><span id="tab:unnamed-chunk-11">Table 4.6: </span>XGBoost auto regressive models results for the NO2 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="right">Number of variables</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared adjusted</th>
<th align="right">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">XGBoost</td>
<td align="right">16</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.7606</td>
<td align="right">5.88</td>
</tr>
<tr class="even">
<td align="left">XGBoost</td>
<td align="right">16</td>
<td align="left">6 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.3932</td>
<td align="right">10.48</td>
</tr>
<tr class="odd">
<td align="left">XGBoost</td>
<td align="right">16</td>
<td align="left">12 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.3718</td>
<td align="right">10.68</td>
</tr>
<tr class="even">
<td align="left">XGBoost</td>
<td align="right">16</td>
<td align="left">24 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.3213</td>
<td align="right">11.08</td>
</tr>
</tbody>
</table>
<p>And these are the results for the XGBoost multivariate models (Testing data scores. Period: 2017-01-01 - 2017-09-30):</p>
<table>
<caption><span id="tab:unnamed-chunk-12">Table 4.7: </span>XGBoost multivariate models results for the NO2 pollutant</caption>
<thead>
<tr class="header">
<th align="left">Model type</th>
<th align="left">Prediction horizon</th>
<th align="left">Train period</th>
<th align="right">R-Squared adjusted</th>
<th align="right">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">XGBoost MV</td>
<td align="left">1 hour</td>
<td align="left">201401-201612</td>
<td align="right">0.7636</td>
<td align="right">5.72</td>
</tr>
<tr class="even">
<td align="left">XGBoost MV</td>
<td align="left">6 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.4174</td>
<td align="right">10.16</td>
</tr>
<tr class="odd">
<td align="left">XGBoost MV</td>
<td align="left">12 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.4074</td>
<td align="right">10.24</td>
</tr>
<tr class="even">
<td align="left">XGBoost MV</td>
<td align="left">24 hours</td>
<td align="left">201401-201612</td>
<td align="right">0.3813</td>
<td align="right">10.42</td>
</tr>
</tbody>
</table>
<p>The differences between the auto regressive and multivariate coincide largely with what we have seen with the PM10 models. The differences are very limited and grow slightly as we increase the prediction horizon.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="\textwidth" /></p>
<p>But the most important difference with the previous PM10 models is that the NO2 models make much more precise forecasts in general. And this difference in precission grows as we increase the prediction horizon. We can see this effect very clearly in the next graph.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="\textwidth" /></p>
<p>Why these differences? Apart from the possible differences derived from a better or worse variable selection, featuring engineering, etc. we think the key to explain these differences lies on the own behaviour of each variable.</p>
<p>Down below we can see the hourly levels of each pollutant during January 2017. We can clearly see how the hourly patterns of the PM10 levels (first grid of graphs)are much more erratic than the NO2 (second grid), which has a very recognisible pattern.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="\textwidth" /></p>
<p>The Constitución monitoring station is an urban station, very close to one of the busiest traffic areas in the city of Gijón. Therefore, the most of the NO2 measured at this station comes from the transformation of NO emitted by cars engines. The traffic has a very regular pattern, so it is natural than the NO2 measured by this station follows very clear patterns. Meanwhile, the PM10 levels, although they partly depend on the traffic too, has more variate sources and precursors, such as the industrial plants situated to the west of the city.</p>
<p>In short, we are achieving better NO2 forecasts because it is a pollutant which is much easier to forecast than the PM10.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="\textwidth" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualizations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
