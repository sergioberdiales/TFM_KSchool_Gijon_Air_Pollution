---
title: "Pendiente"
output: html_notebook
---

# Bookdown

## Preface

Revisar correccion Javier.

## Intro

Incluir grafico evolucion principales contaminantes

how

Incluir version y configuracion de r / r-studio.

## The Data

Pending:
* Remove fields 'year_month_day', 'rose', 'holiday_type'.  
* Change order fields.
* Rename dd, vv to wd and ws

Hecho
* Upload final dataset to kaggle.  


* Loops & functions:
  
```
kable(air_data_1 %>% filter(SO2 == -9999 | 
                              NO == -9999 |
                              NO2 == -9999 |
                              PM10 == -9999 |
                              O3 == -9999 ))

```

```

air_data_2 <- air_data_1 %>% mutate(SO2 = replace(SO2, SO2 == -9999, NA),
                                    NO = replace(NO, NO == -9999, NA),
                                    NO2 = replace(NO2, NO2 == -9999, NA),
                                    PM10 = replace(PM10, PM10 == -9999, NA),
                                    O3 = replace(O3, O3 == -9999, NA))

```

Hacer tambien un loop para el tema del conteo de negativos.

'During the year 2008 the completeness of several variables (HR, PRB, HS, LL, BEN, TOL y MXIL) decrease until 88% (to do: check there was not caused by a data importing problem.)' Hacer una visualizacion chula de esto. Donde se vea si esta falta de datos a algun periodo determinado.

Que se vean de un color distinto a partir de 0.95 para abajo.
Revisar esto: 
https://haozhu233.github.io/kableExtra/awesome_table_in_html.html
```
data_completeness  %>% 
            mutate_if(is.numeric, function(x) {
            cell_spec(x, bold = T, 
              color = spec_color(x, end = 0.9),
              font_size = spec_font_size(x)) 
          })  %>% kable() %>%
  kable_styling()

  ```
Comprobar que no se pasan de observaciones posibles por ano

Ensanchar las tablas para que ocupen todo el ancho



## Visualizations

Pending:

  - Prioritario
  
  Hacer memoria. Incluir pantallazos de tableau y explicar la estructura de las stories
  
  Arreglar datos último trimestre 2008 Argentina.

  Mejorar títulos de ejes (horas 0 - 24 por ejemplo)
  
  Comprobar fuentes de datos
  
  Hacer pestaña de correlaciones y relaciones entre variables
  
  Eliminar de filtros años sin datos (ejemplo: pm2,5)
  
  Calcular para cada caso cuantas mediciones quedan fuera de los histogramas.
  
  Arreglar marcas de ejes histograma CO
  
  
  - No prioritario
  
  Revisar niveles viernes pm25 constitución.
  
  Hacer por lo menos una version movil.  
  
  Cambiar a hora española
  
  Comprobar esto CO.  Según mis cálculos el 24 de junio de 2010 se habrían superado los límites de media octo horaria de CO. Pero en el informe de 2016 del Principado esto no aparece así, sino que aparece como valor máximo lo que parece un 7 (está en un gráfico). Tambien en Argentina 2008 hay otro maximo que no aparece.
  
  Colgar anotacion comentario O3 montevil explicando zonas rurales contra urbanas.
  
  
  - Hecho
  
    Error calculo medias anuales CO? COMPROBAR. MUY IMPORTANTE. Estaba mal el informe, vi otro informe en     el que las mediciones coincidían con las mías.
  
   Comprobar que tamano poner.
  
    Montar un único workbook con todo
    
    Hacer portada de cada story con la descripci'on
    
  
# Scripts

## Gathering and cleaning data

...

## Data exploration


## Prediction Models ARIMA

Pending: 


__Prioritario__

100, 109, 161, 295, 376, 620

hacer tabla resultados list(c(round(R_squared, 4), round(MAE, 2), round(RMSE, 2)))

Redactar comentarios graficos de residuos 
Redactar comentarios sobre los distintos arimas
Redactar Memoria con los resultados del PM10
dejar no2 de momento

  - R adjusted? Borrar la sd de los scores? (Poner igual los calculos de rmse, mae y demas)
  - h12, h24. FALTA NO2

  - hacer h1 2009-2016. FALTA NO2
  
  

  - Comentar graficos de distribuciones de errores. A;adir linea de tendencia. Hacer analisis de errores.
 
  - Comprobar como se van degradando los resultados del modelo segun va aplicandose el modelo mas   adelante en el tiempo. Esto puede ser facil. Graficamente solo tendria que plotear todos los errores que resultasen del test.
  
  - Hacer una mejor imputacion de nas. Ahora mismo estoy utilizando la media.
  
  - Por que el y_pred h6 tiene 7 nas. No tendria que tener 7?
  

__No tan prioritario__

  - Revisar que significa el Inf en los resultados de los modelos Arima (sale cuando esta creando el modelo).

  - Meter variables exogenas.

  - Change names model arima pm10.
  
  - Hacer mas graficos y estadisticos descriptivos de las series de training y test
  
  - Revisar etiquetas graficos.
  
  - Change colors to the graphic of the base model (line of fitted data vs actual data).
  
      
  - Convertir el codigo del calculo del rmse, mae, r2, sd en una funcion. 
  
  - Crear tabla donde ir guardando los resultados.
  
  - Hacer loop para obtener todos los scores de h1 a h6. y que genere los graficos tambien
  
  - Revisar esto "And the standard deviation of the test data is 10.9, which is smaller than the RMSE (7.45). So, this estimation is better than using the mean."

  
  
Hecho ya:

- Data Exploration. principales estadisticos train / test datasets.

- Utilizar un periodo de train menor.

- Explicar lo que hace la funcion auto.arima (cogerlo del libro de Hindman).




## Prediction Models Machine Learning

- Redaccion
- Carga de archivos seleccion "automatica". Quitar archivos csv y ponerlos en otro sitio.
- Ver si puedo cambiar los parametros del statsmodel para sacar un r2 igual al de sklearn y explicarlo

```{r , warning = FALSE, message= FALSE, out.width= '\\textwidth'}

ggplot(data = as.data.frame(y_pred), aes(x = x)) + geom_histogram()


```

```{r , warning = FALSE, message= FALSE, out.width= '\\textwidth'}

ggplot(data = as.data.frame(y_test), aes(x = PM10_0)) + geom_histogram()


```
